{% extends 'newLayout/base.html' %} {% load static %} {% block content %}
<div class="page-content">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-10 col-sm-9  col-md-11 col-lg-7 step-content">
                <nav class="step-nav">
                    <a href="{% url 'signup:theme_choice' %}">
                        <li>Selecione sua área</li>
                    </a>
                    <li class="active">Personalize</li>
                    <li>Selecionar Plano</li>
                    <li>Acessar</li>
                </nav>

                <div class="row">
                    <div class="col-md-5 align-self-center text-center d-block d-md-none mb-4">
                        <h3>Publicação <br>de exemplo</h3>
                    </div>
                    <div class="col-md-5 align-self-center text-center d-none d-md-block">
                        <h3>Publicação <br>de exemplo</h3>
                        <!-- Botão para acionar modal -->
                        <button type="button" class="buttons btn-1 mt-3" data-toggle="modal" data-target="#modal">
                            <span class="table-div">
                                <span class="table-cell">
                                    Alterar cor
                                </span>
                            </span>
                        </button>
                        <button class="buttons btn-2 mt-3 btn_footer">
                            <span class="table-div">
                                <span class="table-cell">
                                    adicionar<br>rodapé pronto
                                </span>
                            </span>
                        </button>
                    </div>
                    <div class="col-md-7 align-self-center">
                        <div class="page-slider">
                            <div id="carouselExampleControls" class="carousel slide" data-ride="carousel" data-interval="false">
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <div class="item d-flex align-items-center justify-content-center position-relative">
                                            <div class="d-flex justify-content-center position-absolute">
                                                <div id="post_loading{{post_free.id}}" class="spinner-border" role="status" style="color: #341aa1 !important;">
                                                    <span class="sr-only">Loading...</span>
                                                </div>
                                            </div>
                                            <div id="post_content{{post_free.id}}" class="content-item !d-none">
                                                <div class="full-img">
                                                    <div style="position: relative;">
                                                        <img id="post-img{{post_free.id}}" post="{{post_free.id}}" class="post" src="{{post_free.post_image.url}}" alt="">
                                                        <!-- footer -->
                                                        {% if request.session.customer and customer.footer %}
                                                        <img class="footer" src="{{customer.footer.url}}" alt=""> {% else %}
                                                        <img class="footer" src="{% static 'signup/img/footer_default.png' %}" alt="">
                                                        <!--  -->
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% for post in posts %}
                                    <div class="carousel-item">
                                        <div class="full-imgs">
                                            <div style="position: relative;">
                                                <img class="post" src="{{post.post_image_watermark.url}}" alt="">
                                                <!-- footer -->
                                                {% if request.session.customer and customer.footer %}
                                                <img class="footer" src="{{customer.footer.url}}" alt=""> {% else %}
                                                <img class="footer" src="{% static 'signup/img/footer_default.png' %}" alt="">
                                                <!--  -->
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}

                                </div>
                                <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev"><span class="sr-only">Previous</span></a>
                                <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next"><span class="sr-only">Next</span></a>
                            </div>
                        </div>
                        <div class="col-12 text-center mt-2 {% if footer_error %} alert-danger {% endif %}">
                            Seu rodapé deve medir exatamente <br> 1080px por 190px.
                        </div>
                    </div>
                    <div class="col-md-5 align-self-center text-center d-block d-md-none">
                        <button type="button" class="buttons btn-1 mt-3" data-toggle="modal" data-target="#modal">
                            <span class="table-div">
                                <span class="table-cell">
                                    Alterar cor
                                </span>
                            </span>
                        </button>
                        <br>
                        <button class="buttons btn-2 mt-3 btn_footer">
                            <span class="table-div">
                                <span class="table-cell">
                                    adicionar<br>rodapé pronto
                                </span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="pagination-links clearfix">
            <div class="row">
                <div class="col-6">
                    <a href="{% url 'signup:theme_choice' %}" class="back-link">Anterior</a>
                </div>
                <div class="col-6 text-right clearfix">
                    <a href="{% url 'signup:plan_choice' %}" class="line-btn">Pular</a>
                    <a style="cursor: pointer" id="btn_next" class="next-link">Próximo</a>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-5 offset-7 col-sm-5 offset-sm-4">
                    <a href="{% url 'signup:plan_choice' %}" class="text-center line-btn d-block d-md-none">Pular</a>
                </div>
            </div>
        </div>
    </div>
</div>

{% include "signup/components/modal_color.html" %}

<form id="next_tap" action="" enctype="multipart/form-data" method="post">
    {% csrf_token %}
    <input hidden type="text" name="theme" id="id_theme" value="{{theme}}">
    <input hidden type="text" name="color" id="id_color" value="{{color.hexadecimal}}">
    <input hidden type="text" name="next" id="id_next" value="True">
    <input hidden type="file" name="footer" accept="image/*" id="id_footer">
</form>
{% endblock content %} {% block script %} {% if request.session.customer %}
<script>
    $('#btn_next').click(function(e) {
        e.preventDefault();
        $('#next_tap').submit();
    });
</script>
{% else %}
<script>
    $('#btn_next').click(function(e) {
        e.preventDefault();
        if ($('#id_footer').val() != "") {
            $('#next_tap').submit();
        } else {
            alert("Insira o rodapé!")
        }
    });
</script>
{% endif %}
<script>
    $(".btn_footer").click(function() {
        console.log('click')
        setTimeout(function() {
            $("#id_footer").trigger("click");
        }, 500);
    });
    $('#id_footer').change(function(e) {
        var file = e.originalEvent.srcElement.files[0];
        //alert(file.size);
        //var img = document.createElement("img");
        var reader = new FileReader();
        reader.onloadend = function() {
            $('.footer').attr('src', reader.result);
        }
        reader.readAsDataURL(file);
        //alert($('.footer').css("width") + " x " + $('.footer').css("height"))
    });

    $(".btn_color").click(function(e) {
        let child = $(e.target).children().first()
        child.prop("checked", true);
        $('#id_color').val(child.val())
        if ($('#id_footer').val() != "") {
            $("#id_next").val("False")
            $('#next_tap').submit();
        } else {
            $('#form_color').submit()
        }
    });

    $('#post-img{{post_free.id}}').on('load', function() {
        let id = $(this).attr('post');
        //alert(id)
        $("#post_loading" + id).fadeOut('slow');
        //$("#post_content" + id).removeClass('d-none');
        //$("#post_content" + id).hide();
        //$("#post_content" + id).fadeIn('slow');

    });
</script>
{% endblock script %}